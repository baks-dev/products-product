let $btnAddOffer=document.getElementById("offer_addCollection");if($btnAddOffer){let $blockCollectionOffers=document.getElementById("collection-offer");$btnAddOffer.addEventListener("click",(function(){let newForm=document.getElementById(this.dataset.prototype).dataset.prototype;let index=this.dataset.index*1;newForm=newForm.replace(/__offers__/g,index);let div=document.createElement("div");div.classList.add("card");div.classList.add("mb-3");div.classList.add("w-100");div.id="item-collection-offer-"+index;div.innerHTML=newForm;$blockCollectionOffers.append(div);div.querySelector(".del-item-offer").addEventListener("click",deleteOffer);let $inputValue=div.querySelector("#product_form_offer_"+index+"_value");replaceReference($inputValue,"product_form_data-offer-reference");div.querySelector(".offer-image-add-collection")?.addEventListener("click",addOfferImage);document.querySelectorAll("#item-collection-offer-"+index+" .card-body-offers .offer-item-collection").forEach((element=>{processOfferDragNDrop(element)}));document.querySelectorAll("#item-collection-offer-"+index+" .card-body-variations .variation-item-collection").forEach((element=>{processVariationDragNDrop(element)}));document.querySelectorAll("#item-collection-offer-"+index+" .card-body-modifications .modification-item-collection").forEach((element=>{processModificationDragNDrop(element)}));let $changeRoot=div.querySelector('[class^="change-root-"]');if($changeRoot){$changeRoot.checked=true;$changeRoot.addEventListener("change",chanheOfferImageRoot)}div.querySelector(".del-item-offer-image")?.addEventListener("click",deleteOfferImage);div.scrollIntoView({block:"center",inline:"center",behavior:"smooth"});this.dataset.index=(index+1).toString();div.querySelector(".del-item-variation")?.addEventListener("click",deleteVariation);let $inputValueVariation=div.querySelector("#product_form_offer_"+index+"_variation_0_value");replaceReference($inputValueVariation,"product_form_data-variation-reference");div.querySelector(".variation-image-add-collection")?.addEventListener("click",addVariationImage);div.querySelector(".del-item-variation-image")?.addEventListener("click",deleteVariationImage);let changeRadio=div.querySelector(".change-variation-product_form_offer_"+index+"_variation_0");if(changeRadio){changeRadio.checked=true;changeRadio.addEventListener("change",chanheVariationImageRoot)}div.querySelector(".offer-variation-add-collection")?.addEventListener("click",addVariation);div.querySelector(".variation-modification-add-collection")?.addEventListener("click",addModification);div.querySelector(".del-item-modification")?.addEventListener("click",deleteModification);let $inputValueModification=div.querySelector("#product_form_offer_"+index+"_variation_0_modification_0_value");replaceReference($inputValueModification,"product_form_data-modification-reference");div.querySelector(".modification-image-add-collection")?.addEventListener("click",addModificationImage);div.querySelector(".del-item-modification-image")?.addEventListener("click",deleteModificationImage);let changeRadioModification=div.querySelector(".change-modification-product_form_offer_"+index+"_variation_0_modification_0");if(changeRadioModification){changeRadioModification.checked=true;changeRadioModification.addEventListener("change",chanheModificationImageRoot)}div.querySelector(".article-generate")?.addEventListener("click",articleGenerate);offerPreloadPhoto(div)}))}executeFunc((function initDeleteOffer(){let offers=document.querySelectorAll(".del-item-offer");if(offers.length===0){return false}offers.forEach((function(item){item.addEventListener("click",deleteOffer)}));return true}),100,1,1e3);function deleteOffer(){document.getElementById("item-collection-offer-"+this.dataset.index).remove()}document.querySelectorAll(".offer-image-add-collection").forEach((function(item){item.addEventListener("click",addOfferImage)}));function addOfferImage(){let newForm=document.getElementById(this.dataset.prototype).dataset.prototype;let index=this.dataset.index*1;let offer=this.dataset.offer*1;newForm=newForm.replace(/__offers__/g,offer);newForm=newForm.replace(/__offer_image__/g,index);let div=document.createElement("div");div.innerHTML=newForm;div.id="item_product_form_offer_"+offer+"_image_"+index;$offerImageCollection=document.getElementById("offer_image_collection-"+offer);$offerImageCollection.append(div);div.querySelector(".del-item-offer-image").addEventListener("click",deleteOfferImage);div.querySelector(".change-root-"+offer).addEventListener("change",chanheOfferImageRoot);this.dataset.index=(index+1).toString();let inputElement=div.querySelector('input[type="file"]');inputElement.addEventListener("change",(function(e){var file=inputElement.files[0];var reader=new FileReader;let image=div.querySelector(".image-input");reader.onloadend=function(){image.style.setProperty("background-image","url("+reader.result+")","important")};if(file){reader.readAsDataURL(file)}else{image.style.setProperty("background-image","url(/img/blank.svg)","important")}}))}document.querySelectorAll(".del-item-offer-image").forEach((function(item){item.addEventListener("click",deleteOfferImage)}));function deleteOfferImage(){let btnRootId=this.id.replace(/DeleteOfferPhoto/g,"root");let btnRoot=document.getElementById(btnRootId);let photoBlock=document.getElementById(this.dataset.index);let parentElement=photoBlock.parentElement;photoBlock.remove();if(btnRoot){if(btnRoot.checked==true){let nextChaecked=parentElement.querySelector('[class^="change-root-"]');if(nextChaecked){nextChaecked.checked=true}}}}document.querySelectorAll('[class^="change-root-"]').forEach((function(item){item.addEventListener("change",chanheOfferImageRoot)}));function chanheOfferImageRoot(){let offer_photo_collection=document.getElementById("offer_image_collection-"+this.dataset.index);offer_photo_collection.querySelectorAll(".change-root-"+this.dataset.index).forEach((function(rootChack,i,arr){rootChack.checked=false}));this.checked=true}document.querySelectorAll(".offer-variation-add-collection").forEach((function(item){item.addEventListener("click",addVariation)}));function addVariation(){let newForm=document.getElementById(this.dataset.prototype).dataset.prototype;let index=this.dataset.index*1;let offer=this.dataset.offer*1;newForm=newForm.replace(/__offers__/g,offer);newForm=newForm.replace(/__offer_variation__/g,index);let div=document.createElement("div");div.innerHTML=newForm;div.id="item_product_form_offer_"+offer+"_variation_"+index;div.querySelector(".del-item-variation").addEventListener("click",deleteVariation);let $inputValue=div.querySelector("#product_form_offer_"+offer+"_variation_"+index+"_value");replaceReference($inputValue,"product_form_data-variation-reference");div.querySelector(".variation-image-add-collection")?.addEventListener("click",addVariationImage);div.querySelector(".del-item-variation-image")?.addEventListener("click",deleteVariationImage);let changeRadio=div.querySelector(".change-variation-product_form_offer_"+offer+"_variation_"+index);if(changeRadio){changeRadio.checked=true;changeRadio.addEventListener("change",chanheVariationImageRoot)}div.querySelector(".variation-modification-add-collection")?.addEventListener("click",addModification);div.querySelector(".del-item-modification")?.addEventListener("click",deleteModification);let $inputValueModification=div.querySelector("#product_form_offer_"+offer+"_variation_"+index+"_modification_0_value");replaceReference($inputValueModification,"product_form_data-modification-reference");div.querySelector(".modification-image-add-collection")?.addEventListener("click",addModificationImage);div.querySelector(".del-item-modification-image")?.addEventListener("click",deleteModificationImage);let changeRadioModification=div.querySelector(".change-modification-product_form_offer_"+offer+"_variation_"+index+"_modification_0");if(changeRadioModification){changeRadioModification.checked=true;changeRadioModification.addEventListener("change",chanheModificationImageRoot)}let $chanheModificationImageRoot=div.querySelectorAll('[class^="change-modification-"]');if($chanheModificationImageRoot.length===1){$chanheModificationImageRoot.forEach((function(item){item.checked=true}))}let $collection=document.getElementById(this.dataset.collection);$collection.append(div);div.querySelector(".article-generate")?.addEventListener("click",articleGenerate);offerPreloadPhoto(div);this.dataset.index=(index+1).toString();let collection_product_form_offer=document.getElementById("collection_product_form_offer_"+offer+"_variation_"+index);if(!collection_product_form_offer){return}let collection_product_form_offer_modification=collection_product_form_offer.querySelector(".modification-item-collection");if(collection_product_form_offer_modification){processModificationDragNDrop(collection_product_form_offer_modification)}else{processVariationDragNDrop(collection_product_form_offer)}}executeFunc((function initDeleteVariation(){let variation=document.querySelectorAll(".del-item-variation");if(variation.length===0){return false}variation.forEach((function(item){item.addEventListener("click",deleteVariation)}));return true}),100,1,1e3);function deleteVariation(){document.getElementById(this.dataset.index).remove()}document.querySelectorAll(".variation-image-add-collection").forEach((function(item){item.addEventListener("click",addVariationImage)}));function addVariationImage(){let newForm=document.getElementById(this.dataset.prototype).dataset.prototype;let index=this.dataset.index*1;let offer=this.dataset.offer*1;let variation=this.dataset.variation*1;let id=this.dataset.id;newForm=newForm.replace(/__offers__/g,offer);newForm=newForm.replace(/__offer_variation__/g,variation);newForm=newForm.replace(/__variation_image__/g,index);let div=document.createElement("div");div.innerHTML=newForm;div.id="item_product_form_offer_"+offer+"_variation_"+variation+"_image_"+index;let $collection=document.getElementById("collection_"+id);$collection.append(div);div.querySelector(".del-item-variation-image").addEventListener("click",deleteVariationImage);div.querySelector(".change-variation-"+id).addEventListener("change",chanheVariationImageRoot);offerPreloadPhoto(div);this.dataset.index=(index+1).toString()}document.querySelectorAll(".del-item-variation-image").forEach((function(item){item.addEventListener("click",deleteVariationImage)}));function deleteVariationImage(){let btnRootId=this.id.replace(/DeleteVariationPhoto/g,"root");let btnRoot=document.getElementById(btnRootId);let photoBlock=document.getElementById(this.dataset.index);let parentElement=photoBlock.parentElement;photoBlock.remove();if(btnRoot){if(btnRoot.checked==true){let nextChaecked=parentElement.querySelector('[class^="change-variation-"]');if(nextChaecked){nextChaecked.checked=true}}}}document.querySelectorAll('[class^="change-variation-"]').forEach((function(item){item.addEventListener("change",chanheVariationImageRoot)}));function chanheVariationImageRoot(){let variation_photo_collection=document.getElementById("collection_"+this.dataset.index);variation_photo_collection.querySelectorAll(".change-variation-"+this.dataset.index).forEach((function(rootChack,i,arr){rootChack.checked=false}));this.checked=true}document.querySelectorAll(".variation-modification-add-collection").forEach((function(item){item.addEventListener("click",addModification)}));function addModification(){let newForm=document.getElementById(this.dataset.prototype).dataset.prototype;let index=this.dataset.index*1;let offer=this.dataset.offer*1;let variation=this.dataset.variation*1;newForm=newForm.replace(/__offers__/g,offer);newForm=newForm.replace(/__offer_variation__/g,variation);newForm=newForm.replace(/__variation_modification__/g,index);let div=document.createElement("div");div.innerHTML=newForm;div.id="item_product_form_offer_"+offer+"_variation_"+variation+"_modification_"+index;div.querySelector(".del-item-modification").addEventListener("click",deleteModification);let $inputValue=div.querySelector("#product_form_offer_"+offer+"_variation_"+variation+"_modification_"+index+"_value");replaceReference($inputValue,"product_form_data-modification-reference");div.querySelector(".modification-image-add-collection")?.addEventListener("click",addModificationImage);div.querySelector(".del-item-modification-image")?.addEventListener("click",deleteModificationImage);let changeRadio=div.querySelector(".change-modification-product_form_offer_"+offer+"_variation_"+variation+"_modification_"+index);if(changeRadio){changeRadio.checked=true;changeRadio.addEventListener("change",chanheModificationImageRoot)}let $collection=document.getElementById(this.dataset.collection);$collection.append(div);div.querySelector(".article-generate")?.addEventListener("click",articleGenerate);offerPreloadPhoto(div);this.dataset.index=(index+1).toString();let collection_product_form_offer=document.getElementById("collection_product_form_offer_"+offer+"_variation_"+variation+"_modification_"+index);processModificationDragNDrop(collection_product_form_offer)}executeFunc((function initDeleteModification(){let modification=document.querySelectorAll(".del-item-modification");if(modification.length===0){return false}modification.forEach((function(item){item.addEventListener("click",deleteModification)}));return true}),100,1,1e3);function deleteModification(){document.getElementById(this.dataset.index).remove()}document.querySelectorAll(".modification-image-add-collection").forEach((function(item){item.addEventListener("click",addModificationImage)}));function addModificationImage(){let newForm=document.getElementById(this.dataset.prototype).dataset.prototype;let index=this.dataset.index*1;let offer=this.dataset.offer*1;let variation=this.dataset.variation*1;let modification=this.dataset.modification*1;let id=this.dataset.id;newForm=newForm.replace(/__offers__/g,offer);newForm=newForm.replace(/__offer_variation__/g,variation);newForm=newForm.replace(/__variation_modification__/g,modification);newForm=newForm.replace(/__modification_image__/g,index);let div=document.createElement("div");div.innerHTML=newForm;div.id="item_product_form_offer_"+offer+"_variation_"+variation+"_modification_"+modification+"_image_"+index;let $collection=document.getElementById("collection_"+id);$collection.append(div);div.querySelector(".del-item-modification-image").addEventListener("click",deleteModificationImage);div.querySelector(".change-modification-"+id).addEventListener("change",chanheModificationImageRoot);offerPreloadPhoto(div);this.dataset.index=(index+1).toString()}document.querySelectorAll(".del-item-modification-image").forEach((function(item){item.addEventListener("click",deleteModificationImage)}));function deleteModificationImage(){let btnRootId=this.id.replace(/DeleteModificationPhoto/g,"root");let btnRoot=document.getElementById(btnRootId);let photoBlock=document.getElementById(this.dataset.index);let parentElement=photoBlock.parentElement;photoBlock.remove();if(btnRoot){if(btnRoot.checked==true){let nextChaecked=parentElement.querySelector('[class^="change-modification-"]');if(nextChaecked){nextChaecked.checked=true}}}}document.querySelectorAll('[class^="change-modification-"]').forEach((function(item){item.addEventListener("change",chanheModificationImageRoot)}));function chanheModificationImageRoot(){let modification_photo_collection=document.getElementById("collection_"+this.dataset.index);modification_photo_collection.querySelectorAll(".change-modification-"+this.dataset.index).forEach((function(rootChack,i,arr){rootChack.checked=false}));this.checked=true}function offerPreloadPhoto(div){let inputElements=div.querySelectorAll('input[type="file"]');inputElements.forEach((function(inputElement,i,arr){inputElement.addEventListener("change",(function(e){var file=this.files[0];var reader=new FileReader;let image=this.closest(".image-input");reader.onloadend=function(){image.style.setProperty("background-image","url("+reader.result+")","important")};if(file){reader.readAsDataURL(file)}else{image.style.setProperty("background-image","url(/img/blank.svg)","important")}}))}))}function replaceReference($replace,$id){if(!$replace){return}let $reference=document.getElementById($id);if($reference===null||$reference.tagName!="SELECT"){return}if($reference){let cloneNode=$reference.cloneNode(true);cloneNode.id=$replace.id;cloneNode.name=$replace.name;cloneNode.value="";if(cloneNode.options!==undefined){cloneNode.options[0].selected=true;cloneNode.options[0].selected="selected";cloneNode.selectedIndex=0;for(let i=0,l=cloneNode.options.length;i<l;i++){cloneNode.options[i].removeAttribute("selected");cloneNode.options[i].selected=false}}$replace.replaceWith(cloneNode);new NiceSelect(cloneNode,{searchable:true})}}document.querySelectorAll(".article-generate").forEach((function(item){item.addEventListener("click",articleGenerate)}));function articleGenerate(){let generate="";product=document.getElementById("product_form_info_article");if(product){generate+=product.value}if(this.dataset.offer){let article=document.getElementById(this.dataset.offer);if(article&&article.value.length){generate+=(generate.length?"-":"")+article.value}}if(this.dataset.offerpostfix){article=document.getElementById(this.dataset.offerpostfix);if(article&&article.value.length){generate+=(generate.length?"-":"")+article.value}}if(this.dataset.variation){article=document.getElementById(this.dataset.variation);if(article&&article.value.length){generate+=(generate.length?"-":"")+article.value}}if(this.dataset.variationpostfix){article=document.getElementById(this.dataset.variationpostfix);if(article&&article.value.length){generate+=(generate.length?"-":"")+article.value}}if(this.dataset.modification){article=document.getElementById(this.dataset.modification);if(article&&article.value.length){generate+=(generate.length?"-":"")+article.value}}if(this.dataset.modificationpostfix){article=document.getElementById(this.dataset.modificationpostfix);if(article&&article.value.length){generate+=(generate.length?"-":"")+article.value}}const colorMap={"000000":"BLACK",FFFFFF:"WHITE",808080:"GRAY",FF0000:"RED",800080:"VIOLET",FFA500:"ORANGE",FFFF00:"YELLOW",947862:"KHAKI","008000":"GREEN","0000FF":"BLUE",F5F5DC:"BEIGE",D2691E:"CHOCO",FFC0CB:"PINK",A52A2A:"BROWN","60020E":"BORDO"};generate=generate.replace(/([0-9A-F]{6})/gi,(match=>colorMap[match.toUpperCase()]||match));result=document.getElementById(this.dataset.id);if(result){result.value=generate.replace(/[^a-zA-Z0-9]/g,"-")}}document.querySelectorAll(".card-body-offers .offer-item-collection").forEach((element=>{processOfferDragNDrop(element)}));function processOfferDragNDrop(offer_image_collection){processDragNDropEvents(offer_image_collection,previewAndAttachOfferFile);function previewAndAttachOfferFile(file){if(!file.type.startsWith("image/")){return}const reader=new FileReader;reader.readAsDataURL(file);reader.onloadend=function(){let parent_card=offer_image_collection.closest(".card");let offer_image_add_collection=parent_card.querySelector(".offer-image-add-collection");let newPrototype=offer_image_add_collection.dataset.prototype;let newForm=document.getElementById(newPrototype).dataset.prototype;let index=offer_image_add_collection.dataset.index*1;let offer=offer_image_add_collection.dataset.offer*1;newForm=newForm.replace(/__offers__/g,offer);newForm=newForm.replace(/__offer_image__/g,index);let div=document.createElement("div");div.innerHTML=newForm;div.id="item_product_form_offer_"+offer+"_image_"+index;$offerImageCollection=document.getElementById("offer_image_collection-"+offer);$offerImageCollection.append(div);div.querySelector(".del-item-offer-image").addEventListener("click",deleteOfferImage);div.querySelector(".change-root-"+offer).addEventListener("change",chanheOfferImageRoot);offer_image_add_collection.dataset.index=(index+1).toString();processDragNDropFileInput(div,reader,file)}}}document.querySelectorAll(".card-body-variations .variation-item-collection").forEach((element=>{processVariationDragNDrop(element)}));function processVariationDragNDrop(offer_variation_image_collection){processDragNDropEvents(offer_variation_image_collection,previewAndAttachVariationFile);function previewAndAttachVariationFile(file){if(!file.type.startsWith("image/")){return}const reader=new FileReader;reader.readAsDataURL(file);reader.onloadend=function(){let parent_card=offer_variation_image_collection.closest(".card");let variation_image_add_collection=parent_card.querySelector(".variation-image-add-collection");let newPrototype=variation_image_add_collection.dataset.prototype;let newForm=document.getElementById(newPrototype).dataset.prototype;let index=variation_image_add_collection.dataset.index*1;let offer=variation_image_add_collection.dataset.offer*1;let variation=variation_image_add_collection.dataset.variation*1;let id=variation_image_add_collection.dataset.id;newForm=newForm.replace(/__offers__/g,offer);newForm=newForm.replace(/__offer_variation__/g,variation);newForm=newForm.replace(/__variation_image__/g,index);let div=document.createElement("div");div.innerHTML=newForm;div.id="item_product_form_offer_"+offer+"_variation_"+variation+"_image_"+index;let $collection=document.getElementById("collection_"+id);$collection.append(div);div.querySelector(".del-item-variation-image").addEventListener("click",deleteVariationImage);div.querySelector(".change-variation-"+id).addEventListener("change",chanheVariationImageRoot);variation_image_add_collection.dataset.index=(index+1).toString();processDragNDropFileInput(div,reader,file)}}}document.querySelectorAll(".card-body-modifications .modification-item-collection").forEach((element=>{processModificationDragNDrop(element)}));function processModificationDragNDrop(offer_variation_modification_image_collection){processDragNDropEvents(offer_variation_modification_image_collection,previewAndAttachModificationFile);function previewAndAttachModificationFile(file){if(!file.type.startsWith("image/")){return}const reader=new FileReader;reader.readAsDataURL(file);reader.onloadend=function(){let parent_card=offer_variation_modification_image_collection.closest(".card");let modification_image_add_collection=parent_card.querySelector(".modification-image-add-collection");let newPrototype=modification_image_add_collection.dataset.prototype;let newForm=document.getElementById(newPrototype).dataset.prototype;let index=modification_image_add_collection.dataset.index*1;let offer=modification_image_add_collection.dataset.offer*1;let variation=modification_image_add_collection.dataset.variation*1;let modification=modification_image_add_collection.dataset.modification*1;let id=modification_image_add_collection.dataset.id;newForm=newForm.replace(/__offers__/g,offer);newForm=newForm.replace(/__offer_variation__/g,variation);newForm=newForm.replace(/__variation_modification__/g,modification);newForm=newForm.replace(/__modification_image__/g,index);let div=document.createElement("div");div.innerHTML=newForm;div.id="item_product_form_offer_"+offer+"_variation_"+variation+"_modification_"+modification+"_image_"+index;let $collection=document.getElementById("collection_"+id);$collection.append(div);div.querySelector(".del-item-modification-image").addEventListener("click",deleteModificationImage);div.querySelector(".change-modification-"+id).addEventListener("change",chanheModificationImageRoot);modification_image_add_collection.dataset.index=(index+1).toString();processDragNDropFileInput(div,reader,file)}}}function processDragNDropFileInput(div,reader,file){let inputElement=div.querySelector('input[type="file"]');let image=div.querySelector(".image-input");image.style.backgroundImage=`url('${reader.result}')`;const dataTransfer=new DataTransfer;dataTransfer.items.add(file);inputElement.files=dataTransfer.files}function processDragNDropEvents(element,previewAndAttachCallback){["dragenter","dragover","dragleave","drop"].forEach((event=>{element.addEventListener(event,(function(e){e.preventDefault();e.stopPropagation()}),false)}));["dragenter","dragover"].forEach((event=>{element.addEventListener(event,(()=>{element.classList.add("shadow")}),false)}));["dragleave","drop"].forEach((event=>{element.addEventListener(event,(()=>{element.classList.remove("shadow")}),false)}));element.addEventListener("drop",(function(e){const dt=e.dataTransfer;const files=dt.files;[...files].forEach(previewAndAttachCallback)}))}