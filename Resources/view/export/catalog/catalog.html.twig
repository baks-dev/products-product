<?xml version="1.0"?>

<yml_catalog date='{{ 'now'|date('Y-m-d\\TH:00:00P') }}'>
    <shop>
        <name>{{ settings.title is defined ?: 'Company name' }}</name>
        <company>{{ settings.description is defined ?: 'Добро пожаловать' }}</company>
        <url>{{ absolute_url(path('core:public.homepage')) }}</url>
        <platform>Symfony</platform>
        <version>1.0</version>
        {# <agency>Технологичные решения</agency> #}
        {# <email>example-email@gmail.com</email> #}

        <categories>
            {% for id, cat in category %}
                <category
                        id='{{ id }}'{# {{ cat.parent_category ? " parentId='"~cat.parent_category~"'":"" }} #}>{{ cat.category_name }}</category>
            {% endfor %}
        </categories>

        {# @var card \BaksDev\Products\Product\Repository\AllProductsByCategory\AllProductsByCategoryResult #}

        <offers>
            {% for card in products %}

                <offer id='{{ card.productId }}' available='{{ card.productQuantity ? 'true' : 'false' }}'>
                    <name>{{ card.productName }}
                        {# Значение множественного варианта ТП #}
                        {{ card.variationValue|call_twig_func(card.variationReference) ~ card.modificationValue|call_twig_func(card.modificationReference) }}
                        {# Значение торгового предложения #}
                        {{ card.offerValue|call_twig_func(card.offerReference) }}
                        {# Постфикс торгового предложения #}
                        {{ card.offerPostfix }}
                        {# Постфикс множественного варианта #}
                        {{ card.variationPostfix }}
                        {# Постфикс модификации #}
                        {{ card.modificationPostfix }}</name>
                    <vendor>{{ card.productName }}</vendor>
                    <vendorCode>{{ card.productArticle }}</vendorCode>
                    <categoryId>{{ card.categoryId }}</categoryId>

                    {# Обложка  #}
                    {% set image_path = cdn_image_path(card.productImage, card.productImageExt, card.productImageCdn, 'large') %}

                    <picture>{{ absolute_url(image_path) }}</picture>
                    <description>
                        <![CDATA[ {{ card.preview|raw }} ]]>
                    </description>

                    {# Официальная гарантия производителя #}
                    {# <manufacturer_warranty>true</manufacturer_warranty> #}
                    {# <country_of_origin>Китай</country_of_origin> #}

                    {% if card.productBarcode %}
                        <barcode>{{ card.productBarcode }}</barcode>
                    {% else %}
                        <barcode>{{ barcode(card.productArticle) }}</barcode>
                    {% endif %}

                    {# Свойства, учавствующие в ПРЕВЬЮ #}
                    {% set arr_property = card.category_section_field %}

                    {% if arr_property %}
                        {% for name_property in arr_property | filter(preview => preview.field_card == true) %}
                            {% set var = name_property.field_value|call_twig_func(name_property.field_type) %}
                            {% if var %}
                                <param name='{{ name_property.field_trans }}'>{{ var }}</param>
                            {% endif %}
                        {% endfor %}
                    {% endif %}


                    {# <weight>3.6</weight> #}
                    {# <dimensions>20.1/20.5/22.5</dimensions> #}
                    {# <service-life-days>P2Y</service-life-days> #}
                    {# <comment-life-days>Использовать при температуре не ниже -10 градусов.</comment-life-days> #}
                    {# <warranty-days>P1Y</warranty-days> #}
                    {# <comment-warranty>Гарантия не распространяется на механические повреждения покрытия чаши.</comment-warranty> #}
                </offer>

            {% endfor %}

        </offers>
    </shop>
</yml_catalog>


